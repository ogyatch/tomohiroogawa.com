---
const { frontmatter, url } = Astro.props;

// Logic: ナンバリング計算
const posts = await Astro.glob('../pages/journal/*.md');
const sortedPosts = posts.sort((a, b) => 
  new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf()
);
const currentIndex = sortedPosts.findIndex((post) => post.url === url);
const entryNumber = String(sortedPosts.length - currentIndex).padStart(3, '0');
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{frontmatter.title} | Tomohiro Ogawa</title>
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans+JP:wght@300;400;600&display=swap" rel="stylesheet">

		<style>
			/* Reset & Base */
			* { box-sizing: border-box; }

			/* スクロールバーの軸ズレ防止 */
			html {
				scrollbar-gutter: stable;
			}
			
			body {
				font-family: "IBM Plex Sans JP", sans-serif;
				font-weight: 400;
				font-feature-settings: "palt";
				background-color: #fff;
				color: #111;
				margin: 0;
				display: flex;
				justify-content: center;
				min-height: 100vh;
			}

			.grid-container {
				width: 100%;
				max-width: 720px;
				padding: 6rem 2rem;
				display: flex;
				flex-direction: column;
			}

			.site-identity {
				display: block;
				margin-bottom: 6rem;
				font-size: 1.2rem;
				font-weight: 600;
				letter-spacing: 0.05em;
				text-transform: uppercase;
				line-height: 1;
				text-decoration: none;
				color: #111;
				transition: opacity 0.2s;
			}
			.site-identity:hover {
				opacity: 0.6;
			}

			header {
				margin-bottom: 5rem;
			}

			/* Meta Data: トップページと完全一致させる */
			.meta {
				font-family: "IBM Plex Mono", monospace;
				font-size: 0.75rem;
				color: #888;
				margin-bottom: 0.6rem;
				display: flex;
				gap: 1rem; /* 1.2rem -> 1rem: 修正箇所 */
			}

			h1 {
				font-size: 2rem;
				font-weight: 600;
				margin: 0;
				line-height: 1.2;
				letter-spacing: 0.02em;
			}

			main {
				font-size: 1rem;
				line-height: 1.8;
				font-weight: 400;
			}
			main :global(p) {
				margin-bottom: 2rem;
				text-align: justify;
			}
			main :global(h2) {
				font-size: 1.2rem;
				font-weight: 600;
				margin-top: 4rem;
				margin-bottom: 1.5rem;
				letter-spacing: 0.05em;
			}
			main :global(img) {
				max-width: 100%;
				height: auto;
				display: block;
				margin: 3rem 0;
			}
			main :global(ul) {
				padding-left: 1rem;
				margin-bottom: 2rem;
			}
			main :global(li) {
				margin-bottom: 0.5rem;
			}
			main :global(blockquote) {
				margin: 3rem 0;
				padding-left: 1.5rem;
				border-left: 2px solid #111;
				font-style: italic;
				color: #444;
			}
			main :global(pre) {
				font-family: "IBM Plex Mono", monospace;
				background: #f4f4f4;
				padding: 1.5rem;
				overflow-x: auto;
				font-size: 0.85rem;
				margin: 2rem 0;
			}
		</style>
	</head>
	<body>
		<div class="grid-container">
			<a href="/" class="site-identity">Tomohiro Ogawa</a>

			<header>
				<div class="meta">
					<span>#{entryNumber}</span>
					<time datetime={frontmatter.pubDate}>
						{new Date(frontmatter.pubDate).toLocaleDateString('en-CA')}
					</time>
				</div>
				<h1>{frontmatter.title}</h1>
			</header>

			<main>
				<slot />
			</main>
		</div>
	</body>
</html>