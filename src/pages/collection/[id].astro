---
import collectionData from '../../data/collection.json';

export async function getStaticPaths() {
  return collectionData.map((item) => {
    const index = collectionData.findIndex(d => d.id === item.id);
    const prevItem = index > 0 ? collectionData[index - 1] : null;
    const nextItem = index < collectionData.length - 1 ? collectionData[index + 1] : null;

    return {
      params: { id: item.id },
      props: { item, prevItem, nextItem },
    };
  });
}

const { item, prevItem, nextItem } = Astro.props;
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{item.title} | Collection</title>
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans+JP:wght@300;400;600&display=swap" rel="stylesheet">

		<style>
			* { box-sizing: border-box; }
			
			/* スクロールバーのガタつきを防止 */
			html {
				scrollbar-gutter: stable;
			}

			body {
				font-family: "IBM Plex Sans JP", sans-serif;
				background-color: #fff;
				color: #111;
				margin: 0;
				min-height: 100vh;
				display: flex;
				flex-direction: column;
			}

			/* 画面全体を一つのキャンバスとする */
			.inspection-container {
				flex: 1;
				display: flex;
				flex-direction: column;
				padding: 4rem 3rem; /* 広めの余白 */
				max-width: 1400px;
				margin: 0 auto;
				width: 100%;
                justify-content: center; /* 上下中央配置 */
			}

			/* 1. The Stage (Image Area) */
			.stage {
				flex: 1;
				display: flex;
				align-items: center;
				justify-content: center;
				margin-bottom: 3rem; /* パネルとの距離 */
			}

			.artwork {
				max-width: 100%;
				max-height: 75vh; /* 画面内に収まる高さ */
				width: auto;
				height: auto;
				display: block;
				object-fit: contain;
                /* クリックで戻る（UX向上のため） */
                cursor: zoom-out;
			}

			/* 2. The Instrument Panel (Footer Area) */
			.instrument-panel {
				display: flex;
				justify-content: space-between;
				align-items: flex-end; /* 下揃え */
				width: 100%;
				font-size: 0.9rem;
                border-top: none; /* 線は削除 */
			}

			/* Left: Context (Emotion) */
			.panel-left {
				display: flex;
				flex-direction: column;
				gap: 0.5rem;
				max-width: 50%;
			}

			h1 {
				font-size: 1.2rem;
				font-weight: 500;
				margin: 0;
				letter-spacing: 0.03em;
				line-height: 1.2;
			}

			.note {
				font-size: 0.9rem;
				color: #444;
				line-height: 1.6;
				margin: 0;
			}

			/* Right: System (Logic & Control) */
			.panel-right {
				display: flex;
				flex-direction: column;
				align-items: flex-end;
				gap: 1.5rem;
				text-align: right;
			}

			.meta-data {
				font-family: "IBM Plex Mono", monospace;
				font-size: 0.75rem;
				color: #888;
				display: flex;
				flex-direction: column;
				gap: 0.2rem;
			}

			/* Navigation Controls */
			.controls {
				font-family: "IBM Plex Mono", monospace;
				font-size: 0.9rem;
				display: flex;
				gap: 2rem; /* 操作項目の間隔 */
			}

			.control-link {
				text-decoration: none;
				color: #111;
				transition: opacity 0.2s;
                display: flex;
                align-items: center;
                gap: 0.5rem;
			}
			.control-link:hover { opacity: 0.5; }
			
			.disabled {
				color: #eaeaea;
				pointer-events: none;
			}

            /* Mobile Response */
            @media (max-width: 768px) {
                .inspection-container { padding: 2rem 1.5rem; }
                .instrument-panel { flex-direction: column; gap: 2rem; align-items: flex-start; }
                .panel-right { align-items: flex-start; text-align: left; width: 100%; flex-direction: row-reverse; justify-content: space-between;}
                .artwork { max-height: 60vh; }
            }
		</style>
	</head>
	<body>
		<div class="inspection-container">
			
			<div class="stage">
                <a href="/collection">
				    <img src={item.image} alt={item.title} class="artwork" />
                </a>
			</div>

			<footer class="instrument-panel">
				
				<div class="panel-left">
					<h1>{item.title}</h1>
					<p class="note">{item.note}</p>
				</div>

				<div class="panel-right">
					<div class="meta-data">
						<span>DATE: {item.date}</span>
						<span>SRC : {item.source}</span>
						<span>ID  : #{item.id}</span>
					</div>

					<nav class="controls">
						{prevItem ? (
							<a href={`/collection/${prevItem.id}`} class="control-link">
                                <span>&larr; PREV</span>
                            </a>
						) : (
							<span class="control-link disabled">&larr; PREV</span>
						)}

						<a href="/collection" class="control-link">
                            [INDEX]
                        </a>

						{nextItem ? (
							<a href={`/collection/${nextItem.id}`} class="control-link">
                                <span>NEXT &rarr;</span>
                            </a>
						) : (
							<span class="control-link disabled">NEXT &rarr;</span>
						)}
					</nav>
				</div>

			</footer>
		</div>
	</body>
</html>