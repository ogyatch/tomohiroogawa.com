---
import collectionData from '../../data/collection.json';

export async function getStaticPaths() {
  return collectionData.map((item) => {
    const index = collectionData.findIndex(d => d.id === item.id);
    const prevItem = index > 0 ? collectionData[index - 1] : null;
    const nextItem = index < collectionData.length - 1 ? collectionData[index + 1] : null;

    return {
      params: { id: item.id },
      props: { item, prevItem, nextItem },
    };
  });
}

const { item, prevItem, nextItem } = Astro.props;
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{item.title} | Collection</title>
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans+JP:wght@300;400;600&display=swap" rel="stylesheet">

		<style>
			* { box-sizing: border-box; }
			html { scrollbar-gutter: stable; }

			body {
				font-family: "IBM Plex Sans JP", sans-serif;
				background-color: #fff;
				color: #111;
				margin: 0;
				/* Dynamic Viewport Height: モバイルのアドレスバー対策 */
				height: 100dvh; 
				overflow: hidden; /* スクロール完全禁止 */
			}

			/* 画面全体レイアウト (Grid) */
			.inspection-container {
				display: grid;
				/* Fix: minmax(0, 1fr) 
                   画像エリアの最小サイズを0に設定し、コンテンツによる拡張を強制阻止する
                */
				grid-template-rows: minmax(0, 1fr) auto; 
				height: 100%;
				padding: 3rem;
				gap: 2rem;
				width: 100%;
			}

			/* 1. The Stage (Image Area) */
			.stage {
				width: 100%;
				height: 100%;
				display: flex;
				align-items: center;
				justify-content: center;
                overflow: hidden; /* 万が一のはみ出しもカット */
			}

			.artwork {
				max-width: 100%;
				max-height: 100%;
				width: auto;
				height: auto;
				object-fit: contain; /* アスペクト比維持 */
				cursor: zoom-out;
			}

			/* 2. The Instrument Panel (Footer) */
			.instrument-panel {
				display: grid;
				grid-template-columns: 1fr 240px; 
				gap: 2rem;
				width: 100%;
				align-items: start;
                /* パネル自体の高さが暴れないように制限 */
                max-height: 30vh; 
                overflow-y: auto; /* 万が一テキストが多すぎる場合はここだけスクロール */
			}

			/* Left Block: Title & Context */
			.panel-info {
				display: flex;
				flex-direction: column;
				gap: 0.5rem;
			}

			h1 {
				font-family: "IBM Plex Sans JP", sans-serif;
				font-size: 1rem;
				font-weight: 500;
				margin: 0;
				letter-spacing: 0.03em;
				line-height: 1.4;
			}

			.note {
				font-family: "IBM Plex Mono", monospace;
				font-size: 0.75rem;
				color: #666;
				line-height: 1.6;
				margin: 0;
				max-width: 600px;
			}

			/* Right Block: System & Controls */
			.panel-system {
				display: flex;
				flex-direction: column;
				gap: 1rem;
				text-align: right;
			}

			.meta-data {
				font-family: "IBM Plex Mono", monospace;
				font-size: 0.7rem;
				color: #999;
				display: flex;
				flex-direction: column;
				gap: 0.2rem;
			}

			.controls {
				font-family: "IBM Plex Mono", monospace;
				font-size: 0.8rem;
				display: flex;
				justify-content: flex-end;
				gap: 1.5rem;
				margin-top: 0.5rem;
			}

			.control-link {
				text-decoration: none;
				color: #111;
				transition: opacity 0.2s;
			}
			.control-link:hover { opacity: 0.5; }
			
			.disabled {
				color: #eaeaea;
				pointer-events: none;
			}

			/* Mobile Layout */
			@media (max-width: 768px) {
				.inspection-container { padding: 1.5rem; gap: 1rem; }
				.instrument-panel { 
					grid-template-columns: 1fr;
					gap: 1.5rem;
                    max-height: 40vh; /* スマホでは少し広めに許可 */
				}
				.panel-system { 
					text-align: left; 
					flex-direction: row; 
					justify-content: space-between;
					align-items: flex-end;
				}
				.meta-data { text-align: left; }
			}
		</style>
	</head>
	<body>
		<div class="inspection-container">
			
			<div class="stage">
				<a href="/collection" aria-label="Back to collection">
					<img src={item.image} alt={item.title} class="artwork" />
				</a>
			</div>

			<footer class="instrument-panel">
				
				<div class="panel-info">
					<h1>{item.title}</h1>
					<p class="note">{item.note}</p>
				</div>

				<div class="panel-system">
					<div class="meta-data">
						<span>{item.date}</span>
						<span>{item.source}</span>
					</div>

					<nav class="controls">
						{prevItem ? (
							<a href={`/collection/${prevItem.id}`} class="control-link">
								&larr; {prevItem.id}
							</a>
						) : (
							<span class="control-link disabled">&larr; ---</span>
						)}

						{nextItem ? (
							<a href={`/collection/${nextItem.id}`} class="control-link">
								{nextItem.id} &rarr;
							</a>
						) : (
							<span class="control-link disabled">--- &rarr;</span>
						)}
					</nav>
				</div>

			</footer>
		</div>
	</body>
</html>